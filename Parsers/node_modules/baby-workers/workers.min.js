var Workers=function(){var t=null,e={ROOT:"root",PARENT:"parent",NODE:"node"},n={CANCEL:"cancel",WAITING:"waiting",RUNNING:"running",FINISH:"finish"};Object.values="function"!=typeof Object.values?function(t){return Object.keys(t).map(function(e){return t[e]})}:Object.values;var r=function(i){this.flux={},this.create=function(t,n,i){return n="function"==typeof t?t:n,null===(t="function"==typeof t?null:t)||void 0===f.children[t]&&void 0===f.this[t]?(f.children[t]=new r(t),f.children[t].init(f.this,e.PARENT),f.children[t].setInfos(n),void 0!==(i="function"==typeof t?n:i)&&console.log("baby-worker : create function => data parameter is deprecated. It will be remove in v2.5.0"),!0===Array.isArray(i)?f.children[t].map(i):void 0!==i&&f.children[t].set(i),null!==t&&(f.this[t]=f.children[t]),f.children[t]):null},this.init=function(t,n,r){switch(f.id=r,f.type=n,f.parent=t,n){case e.ROOT:delete f.this.setInfos,delete f.this.set,delete f.this.map,delete f.this.timeout,delete f.this.interval,delete f.this.run,delete f.this.stack,delete f.this.push,delete f.this.cancel,delete f.this.node,delete f.this.pop,delete f.this.root,delete f.this.parent,delete f.this.back,delete f.this.getId,delete f.this.getNodeStatus,delete f.this.getPromise;break;case e.PARENT:delete f.this.all,delete f.this.pop,delete f.this.root,delete f.this.getId,delete f.this.getNodeStatus;break;case e.NODE:delete f.this.setInfos,delete f.this.all,delete f.this.set,delete f.this.map,delete f.this.timeout,delete f.this.interval,delete f.this.run,delete f.this.stack,delete f.this.back,delete f.this.cancel,delete f.this.push,delete f.this.node,delete f.this.getPromise}return delete f.this.init,f.this},this.setInfos=function(t){return d.callback=t,f.status=n.WAITING,delete f.this.setInfos,f.this},this.all=function(){f.this.addWorker();var t=Object.values(arguments),e=null,n=[],r=t.length;return new Promise(function(i,s){var o=function(){0===(r-=1)&&(null!==e?s(e):i(n),f.this.removeWorker())};t.map(function(t,r){"function"==typeof t.then&&"function"==typeof t.catch?t.then(function(t){n[r]=t,o()}).catch(function(t){e=t,o()}):o()})})},this.map=function(t){return!1===Array.isArray(t)?f.this.set(t):(d.data=t,f.this)},this.push=function(t){d.data.push(t);return f.type===e.PARENT&&f.status===n.FINISH&&f.this.next(),f.this},this.set=function(t){return d.data=[t],f.this},this.stack=function(){return d.stack.status=!0,f.this.next(),s()},this.timeout=function(t){return console.log("baby-worker : timeout function is deprecated. It will be remove in v2.5.0"),f.this.delay(t)},this.delay=function(t){return t=null==t||"number"!=typeof t?1:t,setTimeout(f.this.run,t),s()},this.interval=function(t){return t=null==t||"number"!=typeof t?1e3:t,f.this.addWorker(!0),d.isInterval=setInterval(function(){f.this.reply()},t),f.this.stop=function(){f.this.removeWorker(),clearInterval(d.isInterval)},s()},this.run=function(){for(;f.this.next(););return s()},this.reply=function(t){return void 0===t?(0===d.data.length&&d.data.push(void 0),d.data.map(function(t,e){f.this.exec(e,!0)}),s()):f.this.exec(t,!0)},this.next=function(){return d.currentSeek+=1,null===f.this.exec(d.currentSeek,!1)?(d.currentSeek-=1,null):s()},this.exec=function(t,n){if(n="boolean"!=typeof n||n,d.data.length<=t){if(0!==t)return null;d.data.push(void 0)}if(void 0===d.nodes[t]){var i=new r(f.name);i.init(f.this,e.NODE,t),d.nodes.push(i),d.workers+=1}return o(t,n),s()};var s=function(){return f.promise=new Promise(function(t,e){f.this.then(t).catch(e)}),f.promise},o=function(t,e){if(f.status!==n.CANCEL){if(d.stack.currentNode+1!==t&&!1===e)return a(t,e);var r=u();return d.limitWorkers>0&&d.limitWorkers<=d.runningWorkers&&(!1===d.limitExtra||null===r||r.getLimit()>0&&r.getLimit()+d.limitWorkers<=r.getTotalRunningWorkers()+f.this.getRunningWorkers())?a(t,e):0===d.limitWorkers&&null!==r&&r.getLimit()>0&&r.getLimit()<=r.getTotalRunningWorkers()+f.this.getRunningWorkers()?a(t,e):!0===d.stack.status&&d.stack.isRunning!==n.WAITING?a(t,e):l(t,e)}},u=function(t){return void 0===t&&null!=f.parent?u(f.parent):void 0!==t&&0===t.getLimit()&&"function"==typeof t.root?u(t.root()):t},a=function(t,e){return d.waitingWorkers+=1,f.this.addWaitingWorker(),c("waiting",function(n){d.waitingWorkers-=1,f.this.removeWaitingWorker(),o(t,e)}),!1},l=function(t,e){!1===e&&(d.stack.currentNode+=1),d.runningWorkers+=1,d.stack.isRunning=n.RUNNING,d.nodes[t].addWorker(!0),d.nodes[t].complete(function(){d.runningWorkers-=1,!0===d.stack.status&&d.stack.currentNode<d.data.length?(d.stack.isRunning=n.WAITING,f.this.next()):0!==d.waitingWorkers?(d.stack.isRunning=n.WAITING,f.this.next()):null===d.isInterval&&(d.stack.isRunning=n.FINISH),h("waiting")});try{d.callback(d.nodes[t],d.data[t])}catch(e){d.nodes[t].error(e)}return!0};this.limit=function(t,e){return d.limitExtra="boolean"==typeof e&&e,d.limitWorkers=t<-1?-1:t,d.limitWorkers=!0===d.limitExtra&&-1===d.limitWorkers?0:d.limitWorkers,f.this},this.cancel=function(){return f.status===n.FINISH||f.status===n.CANCEL?null:(f.status=n.CANCEL,f.this)},this.error=function(t,e){return e="boolean"!=typeof e||e,f.error=null===f.error?t:f.error,null!==f.parent&&f.parent.error(f.error,!1),!0===e&&f.this.pop(),f.this},this.pop=function(){return f.nodeStatus!==n.RUNNING?null:f.this.removeWorker()},this.addWorker=function(t){return t="boolean"==typeof t&&t,f.status=n.RUNNING,!1===t?f.totalRunningWorkers+=1:f.nodeStatus=n.RUNNING,null!==f.parent&&f.parent.addWorker(!1),f.this},this.removeWorker=function(t){return void 0===t&&f.type===e.NODE?(f.nodeStatus=n.FINISH,t=f.id,null!==f.error?h("catch"):h("then"),h("complete")):(f.totalRunningWorkers-=1,void 0!==t&&h("back",t),0===f.totalRunningWorkers&&0!==f.totalWaitingWorkers&&(h("waiting"),f.status=n.WAITING),0===f.totalRunningWorkers&&0===f.totalWaitingWorkers&&(null!==f.error?h("catch"):h("then"),h("complete"),f.status=f.status===n.CANCEL?f.status:n.FINISH)),null!==f.parent&&f.parent.removeWorker(t),f.this},this.addWaitingWorker=function(){return f.totalWaitingWorkers+=1,null!==f.parent&&f.parent.addWaitingWorker(),f.this},this.removeWaitingWorker=function(){return f.totalWaitingWorkers-=1,null!==f.parent&&f.parent.removeWaitingWorker(),f.this},this.save=function(t,e){void 0===e&&(e=t,t=void 0);var n=function(t,r,i){if(0!==i.length)return t[r]=void 0===t[r]?{}:t[r],n(t[r],i.splice(0,1).shift(),i);t[r]=e};return n(f.this,"flux","string"!=typeof t?[]:t.split(".")),f.this},this._save=function(t,e){var n=f.parent;return null!==n&&n.save(t,e),f.this},this.get=function(t){var e=function(t,n,r){return 0===r.length?t[n]:(t[n]=void 0===t[n]?{}:t[n],e(t[n],r.splice(0,1).shift(),r))};return e(f.this,"flux","string"!=typeof t?[]:t.split("."))},this._get=function(t){var e=f.parent;return null===e?null:e.get(t)},this.root=function(){return f.parent},this.parent=function(n,r){return null==f.parent?null:(r=null==r?e.PARENT:r,f.parent.getName()!==n||r!==t&&f.parent.getType()!==r?void 0===f.parent.parent?null:f.parent.parent(n,r):f.parent)},this.parentNode=function(t){return f.this.parent(t,e.NODE)},this.node=function(t){return null==d.nodes[t]?null:d.nodes[t]},this.back=function(t,e){return c("back",t,e,function(t){return t}),f.this},this.complete=function(t,e){return f.status===n.FINISH&&(t(f.error),"boolean"!=typeof e||1==e)?f.this:(c("complete",t,e,function(){return f.error}),f.this)},this.then=function(t,e){return f.status===n.FINISH&&null===f.error&&(t(f.this.flux),"boolean"!=typeof e||1==e)?f.this:(c("then",t,e,function(){return f.this.flux}),f.this)},this.catch=function(t,e){return f.status===n.FINISH&&null!==f.error&&(t(f.error),"boolean"!=typeof e||1==e)?f.this:(c("catch",t,e,function(){return f.error}),f.this)};var c=function(t,e,n,r){return n="boolean"!=typeof n||n,r="function"==typeof r?r:null,f.callback.push({type:t,callback:e,removeAfterCall:n,param:r}),f.this},h=function(t,e){var n=f.callback;for(var r in f.callback=[],n)n[r].type===t?("boolean"==typeof n[r].removeAfterCall&&0==n[r].removeAfterCall&&f.callback.push(n[r]),n[r].callback("function"==typeof n[r].param?n[r].param(e):n[r].param)):f.callback.push(n[r])};this.getName=function(){return f.name},this.getType=function(){return f.type},this.getId=function(){return f.id},this.getError=function(){return f.error},this.getStatus=function(){return f.status},this.getNodeStatus=function(){return f.nodeStatus},this.getLimit=function(){return d.limitWorkers},this.getWorkers=function(){return d.workers},this.getWaitingWorkers=function(){return d.waitingWorkers},this.getRunningWorkers=function(){return d.runningWorkers},this.getTotalWorkers=function(){return d.nodes.length},this.getTotalWaitingWorkers=function(){return f.totalWaitingWorkers},this.getPromise=function(){return f.promise},this.getTotalRunningWorkers=function(){return f.totalRunningWorkers},this.getNodes=function(){return d.nodes};var d={limitWorkers:0,limitExtra:!1,wasRejected:!1,isInterval:null,nodes:[],workers:0,runningWorkers:0,waitingWorkers:0,data:[],callback:null,stack:{status:!1,currentNode:-1,isRunning:n.WAITING},currentSeek:-1},f={this:this,id:null,name:i,parent:null,status:t,nodeStatus:t,type:t,promise:null,error:null,children:{},callback:[],totalRunningWorkers:0,totalWaitingWorkers:0}};return new r("root").init(null,e.ROOT)};try{module.exports=Workers}catch(t){}